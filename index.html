<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‚è±Ô∏è Ch·∫•m C√¥ng TƒÉng Ca</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'><path fill='%23007AFF' d='M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z'/></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'><path fill='%23007AFF' d='M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z'/></svg>">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
    <style>
        *{margin:0;padding:0;box-sizing:border-box;font-family:'Inter',-apple-system,sans-serif;}
        :root{--primary:#007AFF;--success:#34C759;--warning:#FF9500;--danger:#FF3B30;--light:#F2F2F7;--dark:#1D1D1F;--gray:#8E8E93;--border:#C7C7CC;--card-bg:#FFFFFF;--sunday:#FF2D55;--salary:#5856D6;--toggle-on:#34C759;--toggle-off:#E5E5EA;}
        body{background-color:var(--light);color:var(--dark);line-height:1.5;max-width:100%;overflow-x:hidden;padding-bottom:env(safe-area-inset-bottom);-webkit-tap-highlight-color:transparent;}
        .header{background:linear-gradient(135deg,var(--primary),#5856D6);color:white;padding-top:env(safe-area-inset-top);padding-bottom:20px;text-align:center;position:sticky;top:0;z-index:100;box-shadow:0 4px 12px rgba(0,0,0,0.1);}
        .header-content{padding:15px 20px;}
        .header h1{font-size:24px;font-weight:700;margin-bottom:5px;}
        .header p{opacity:0.9;font-size:14px;font-weight:400;}
        .current-time{background-color:var(--card-bg);margin:15px;padding:15px;border-radius:16px;box-shadow:0 2px 8px rgba(0,0,0,0.05);text-align:center;}
        .current-time h2{font-size:18px;margin-bottom:10px;color:var(--primary);display:flex;align-items:center;justify-content:center;gap:10px;}
        .time-display{font-size:32px;font-weight:700;color:var(--dark);margin:10px 0;}
        .date-display{font-size:16px;color:var(--gray);font-weight:500;}
        .day-indicator{display:inline-flex;align-items:center;padding:6px 12px;border-radius:20px;font-size:14px;font-weight:600;margin-top:8px;background-color:rgba(255,255,255,0.2);}
        .day-indicator.sunday{background-color:var(--sunday);}
        .container{max-width:100%;padding:0 15px 20px;}
        .card{background-color:var(--card-bg);border-radius:16px;padding:20px;margin-bottom:20px;box-shadow:0 4px 12px rgba(0,0,0,0.05);}
        .card h2{font-size:18px;margin-bottom:15px;color:var(--dark);display:flex;align-items:center;gap:10px;}
        .card h2 i{color:var(--primary);}
        .controls{display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-bottom:15px;}
        .btn{background-color:var(--primary);color:white;border:none;border-radius:12px;padding:16px 10px;font-size:17px;font-weight:600;text-align:center;cursor:pointer;transition:all 0.3s;display:flex;align-items:center;justify-content:center;gap:8px;-webkit-tap-highlight-color:transparent;}
        .btn:active{transform:scale(0.97);}
        .btn-full{width:100%;}
        .btn-start{background-color:var(--success);}
        .btn-start:active{background-color:#2DAE4A;}
        .btn-start.auto-activated{background-color:#2DAE4A;border:2px solid #1E8C3E;}
        .btn-end{background-color:var(--warning);}
        .btn-end:active{background-color:#E68500;}
        .btn-save{background-color:#5AC8FA;margin-top:10px;}
        .btn-save:active{background-color:#4AA8D8;}
        .btn-salary-control{background:linear-gradient(135deg,var(--salary),#7D3CFF);margin-top:10px;grid-column:span 2;}
        .btn-small{padding:10px 15px;font-size:14px;border-radius:10px;}
        .btn-secondary{background-color:var(--light);color:var(--dark);border:1px solid var(--border);}
        .btn-secondary:active{background-color:#E5E5EA;}
        .btn-month{background-color:#5AC8FA;margin-top:10px;}
        .btn-month:active{background-color:#4AA8D8;}
        .btn-salary{background-color:var(--salary);margin-top:10px;}
        .btn-salary:active{background-color:#4A4AC8;}
        .btn:disabled{opacity:0.5;cursor:not-allowed;transform:none !important;}
        .auto-start-info{background-color:rgba(52,199,89,0.1);border-radius:10px;padding:12px;margin-top:10px;text-align:center;font-size:14px;color:var(--success);display:flex;align-items:center;justify-content:center;gap:8px;}
        .auto-start-info i{font-size:16px;}
        .work-info{display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-bottom:20px;}
        .info-box{background-color:var(--light);border-radius:12px;padding:15px;text-align:center;}
        .info-box h3{font-size:14px;color:var(--gray);margin-bottom:5px;font-weight:500;}
        .info-value{font-size:20px;font-weight:700;color:var(--dark);}
        .info-unit{font-size:14px;color:var(--gray);margin-left:2px;}
        .expected-salary{background-color:rgba(88,86,214,0.1);border-radius:12px;padding:15px;margin-top:15px;text-align:center;border:2px solid var(--salary);}
        .expected-salary h4{color:var(--salary);margin-bottom:5px;font-size:14px;display:flex;align-items:center;justify-content:center;gap:8px;}
        .expected-amount{font-size:22px;font-weight:700;color:var(--salary);}
        .work-history{max-height:300px;overflow-y:auto;-webkit-overflow-scrolling:touch;}
        .history-item{display:flex;justify-content:space-between;align-items:center;padding:15px 0;border-bottom:1px solid var(--light);}
        .history-item:last-child{border-bottom:none;}
        .history-date{font-weight:600;font-size:16px;color:var(--dark);}
        .history-time{font-size:14px;color:var(--gray);}
        .history-overtime{font-weight:700;font-size:16px;color:var(--success);}
        .footer{text-align:center;padding:20px;color:var(--gray);font-size:14px;border-top:1px solid var(--border);margin-top:10px;}
        .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,0.5);z-index:1000;justify-content:center;align-items:center;padding:20px;overflow-y:auto;}
        .modal-content{background-color:white;border-radius:16px;padding:25px;width:100%;max-width:400px;box-shadow:0 10px 30px rgba(0,0,0,0.2);max-height:90vh;overflow-y:auto;}
        .modal h3{font-size:20px;margin-bottom:15px;color:var(--dark);display:flex;align-items:center;justify-content:space-between;}
        .modal h3 .close-btn{background:none;border:none;color:var(--gray);font-size:24px;cursor:pointer;padding:0;}
        .modal p{margin-bottom:20px;color:var(--gray);line-height:1.6;}
        .modal-buttons{display:flex;gap:10px;margin-top:20px;}
        .calendar{width:100%;}
        .calendar-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;}
        .calendar-month-year{font-size:18px;font-weight:600;color:var(--dark);}
        .calendar-nav{display:flex;gap:10px;}
        .calendar-nav-btn{background-color:var(--light);border:none;border-radius:8px;width:36px;height:36px;display:flex;align-items:center;justify-content:center;cursor:pointer;}
        .calendar-weekdays{display:grid;grid-template-columns:repeat(7,1fr);margin-bottom:10px;text-align:center;font-weight:600;font-size:14px;color:var(--gray);}
        .calendar-weekdays div{padding:8px 0;}
        .calendar-days{display:grid;grid-template-columns:repeat(7,1fr);gap:5px;}
        .calendar-day{aspect-ratio:1;display:flex;flex-direction:column;align-items:center;justify-content:center;border-radius:10px;font-size:16px;font-weight:500;cursor:pointer;transition:all 0.2s;position:relative;}
        .calendar-day:hover{background-color:var(--light);}
        .calendar-day.empty{background-color:transparent;cursor:default;}
        .calendar-day.today{background-color:rgba(0,122,255,0.1);color:var(--primary);font-weight:700;}
        .calendar-day.has-data{background-color:rgba(52,199,89,0.1);}
        .calendar-day.sunday{color:var(--sunday);}
        .calendar-day.selected{background-color:var(--primary);color:white;}
        .day-overtime{font-size:10px;margin-top:2px;color:var(--success);font-weight:700;}
        .day-lunch{position:absolute;top:2px;right:2px;width:6px;height:6px;background-color:var(--warning);border-radius:50%;}
        .day-detail{margin-bottom:20px;}
        .day-detail-info{display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-bottom:20px;}
        .detail-box{background-color:var(--light);border-radius:12px;padding:15px;text-align:center;}
        .detail-box h4{font-size:14px;color:var(--gray);margin-bottom:5px;font-weight:500;}
        .detail-value{font-size:18px;font-weight:700;color:var(--dark);}
        .edit-time{display:flex;gap:10px;margin-bottom:15px;align-items:center;}
        .time-input{flex:1;padding:12px;border-radius:10px;border:1px solid var(--border);background-color:white;font-size:16px;text-align:center;}
        .edit-overtime{margin-bottom:15px;}
        .edit-overtime label{display:block;margin-bottom:8px;font-weight:600;color:var(--dark);}
        .overtime-input{width:100%;padding:12px;border-radius:10px;border:1px solid var(--border);background-color:white;font-size:16px;text-align:center;}
        .edit-buttons{display:flex;gap:10px;margin-top:10px;}
        .salary-input-group{margin-bottom:20px;}
        .salary-input-group label{display:block;margin-bottom:8px;font-weight:600;color:var(--dark);}
        .salary-input{width:100%;padding:15px;border:1px solid var(--border);border-radius:12px;font-size:18px;font-weight:600;text-align:right;background-color:var(--light);}
        .salary-input:focus{outline:none;border-color:var(--primary);}
        .salary-result{background-color:rgba(88,86,214,0.1);border-radius:12px;padding:20px;margin-top:20px;text-align:center;border:2px solid var(--salary);}
        .salary-result h4{color:var(--salary);margin-bottom:10px;font-size:16px;}
        .salary-amount{font-size:28px;font-weight:700;color:var(--salary);margin-bottom:5px;}
        .salary-details{font-size:14px;color:var(--gray);margin-top:10px;text-align:left;}
        .salary-details div{margin-bottom:5px;display:flex;justify-content:space-between;}
        .notification{position:fixed;top:100px;right:20px;background-color:var(--success);color:white;padding:15px 20px;border-radius:12px;box-shadow:0 5px 15px rgba(0,0,0,0.2);z-index:1001;transform:translateX(150%);transition:transform 0.3s ease;max-width:300px;}
        .notification.show{transform:translateX(0);}
        .notification.warning{background-color:var(--warning);}
        .notification.info{background-color:var(--primary);}
        .info-message{background-color:rgba(0,122,255,0.1);border-radius:12px;padding:15px;margin-bottom:20px;border-left:4px solid var(--primary);}
        .info-message h4{color:var(--primary);margin-bottom:5px;font-size:16px;display:flex;align-items:center;gap:8px;}
        
        .toggle-container{display:flex;justify-content:space-between;align-items:center;margin:15px 0;padding:15px;background-color:var(--light);border-radius:12px;}
        .toggle-label{font-weight:600;color:var(--dark);display:flex;align-items:center;gap:10px;}
        .toggle-switch{position:relative;display:inline-block;width:60px;height:34px;}
        .toggle-switch input{opacity:0;width:0;height:0;}
        .toggle-slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:var(--toggle-off);transition:.4s;border-radius:34px;}
        .toggle-slider:before{position:absolute;content:"";height:26px;width:26px;left:4px;bottom:4px;background-color:white;transition:.4s;border-radius:50%;}
        input:checked + .toggle-slider{background-color:var(--toggle-on);}
        input:checked + .toggle-slider:before{transform:translateX(26px);}
        .toggle-status{font-size:14px;font-weight:600;color:var(--gray);}
        .toggle-status.active{color:var(--success);}
        
        .data-status{position:fixed;bottom:20px;right:20px;background-color:rgba(0,122,255,0.1);color:var(--primary);padding:8px 12px;border-radius:20px;font-size:12px;display:flex;align-items:center;gap:5px;z-index:999;}
        
        @media (max-width:350px){.controls{grid-template-columns:1fr;}.btn-salary-control{grid-column:span 1;}.work-info{grid-template-columns:1fr;}.modal-content{padding:15px;}.edit-time{flex-direction:column;}}
        
        /* Save button animation */
        .btn-save.saving{background-color:#34C759;}
        .btn-save.saved{background-color:#007AFF;}
        
        /* Auto-save indicator */
        .auto-save-indicator{
            position:fixed;
            bottom:20px;
            left:20px;
            background-color:rgba(52,199,89,0.1);
            color:var(--success);
            padding:8px 12px;
            border-radius:20px;
            font-size:12px;
            display:flex;
            align-items:center;
            gap:5px;
            z-index:999;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <h1><i class="fas fa-clock"></i> ‚è±Ô∏è Ch·∫•m C√¥ng TƒÉng Ca</h1>
            <p>‚è∞ Gi·ªù l√†m vi·ªác: 7:45 - 17:00 (T2-T7) | üéØ Ch·ªß nh·∫≠t: To√†n b·ªô l√† tƒÉng ca</p>
            <div class="day-indicator" id="dayIndicator">
                <i class="fas fa-calendar-day"></i> <span id="dayName">ƒêang t·∫£i...</span>
            </div>
        </div>
    </header>

    <div class="current-time">
        <h2><i class="fas fa-calendar-alt"></i> üìÖ H√¥m nay</h2>
        <div class="date-display" id="currentDate">ƒêang t·∫£i...</div>
        <div class="time-display" id="currentTime">00:00:00</div>
        <div id="workStatus" style="color: var(--primary); font-weight: 600; margin-top: 5px;">üü° Ch∆∞a b·∫Øt ƒë·∫ßu l√†m vi·ªác</div>
    </div>

    <div class="container">
        <div class="info-message">
            <h4><i class="fas fa-info-circle"></i> üìä Logic ch·∫•m c√¥ng</h4>
            <p><strong>üìÖ Th·ª© 2 - Th·ª© 7:</strong> T·ª± ƒë·ªông b·∫Øt ƒë·∫ßu 7:45, n·∫øu ·∫•n "B·∫Øt ƒë·∫ßu" tr∆∞·ªõc 7:45 th√¨ tr∆∞·ªõc 7:45 l√† tƒÉng ca.</p>
            <p><strong>üéØ Ch·ªß nh·∫≠t:</strong> To√†n b·ªô th·ªùi gian t·ª´ B·∫Øt ƒë·∫ßu ƒë·∫øn Tan ca ƒë·ªÅu t√≠nh l√† tƒÉng ca.</p>
            <p><strong>‚è∞ M·∫∑c ƒë·ªãnh 17:00 tan ca:</strong> N·∫øu kh√¥ng ·∫•n "Tan Ca" s·∫Ω t·ª± ƒë·ªông tan ca l√∫c 17:00.</p>
        </div>
        
        <div class="card">
            <h2><i class="fas fa-play-circle"></i> üéÆ ƒêi·ªÅu khi·ªÉn</h2>
            <div class="controls">
                <button class="btn btn-start" id="startWorkBtn">
                    <i class="fas fa-play"></i> üöÄ B·∫Øt ƒë·∫ßu
                </button>
                <button class="btn btn-end" id="endWorkBtn">
                    <i class="fas fa-stop"></i> üèÅ Tan ca
                </button>
            </div>
            
            <button class="btn btn-save btn-full" id="saveNowBtn">
                <i class="fas fa-save"></i> üíæ L∆∞u ngay
            </button>
            
            <div id="autoStartInfo" class="auto-start-info" style="display: none;">
                <i class="fas fa-robot"></i> ü§ñ T·ª± ƒë·ªông k√≠ch ho·∫°t l√∫c 7:45 (T2-T7)
            </div>
            
            <div class="work-info">
                <div class="info-box">
                    <h3><i class="fas fa-sign-in-alt"></i> Gi·ªù b·∫Øt ƒë·∫ßu</h3>
                    <div class="info-value" id="startTime">--:--</div>
                </div>
                <div class="info-box">
                    <h3><i class="fas fa-sign-out-alt"></i> Gi·ªù k·∫øt th√∫c</h3>
                    <div class="info-value" id="endTime">--:--</div>
                </div>
                <div class="info-box">
                    <h3><i class="fas fa-clock"></i> T·ªïng th·ªùi gian</h3>
                    <div class="info-value" id="totalTime">0<span class="info-unit">gi·ªù</span></div>
                </div>
                <div class="info-box">
                    <h3><i class="fas fa-moon"></i> TƒÉng ca h√¥m nay</h3>
                    <div class="info-value" id="overtime">0<span class="info-unit">gi·ªù</span></div>
                </div>
            </div>
            
            <div class="expected-salary" id="expectedSalary" style="display: none;">
                <h4><i class="fas fa-coins"></i> üí∞ L∆∞∆°ng tƒÉng ca d·ª± ki·∫øn h√¥m nay</h4>
                <div class="expected-amount" id="expectedAmount">0 VNƒê</div>
            </div>
            
            <button class="btn btn-salary-control btn-full" id="salaryBtn">
                <i class="fas fa-calculator"></i> üßÆ T√≠nh L∆∞∆°ng TƒÉng Ca
            </button>
            
            <button class="btn btn-month btn-full" id="viewMonthBtn">
                <i class="fas fa-calendar-alt"></i> üìÖ Xem L·ªãch Th√°ng
            </button>
        </div>

        <div class="card">
            <h2><i class="fas fa-history"></i> üìú L·ªãch s·ª≠ l√†m vi·ªác</h2>
            <div class="work-history" id="workHistory">
                <div style="text-align: center; padding: 30px; color: var(--gray);">
                    <i class="fas fa-history" style="font-size: 40px; margin-bottom: 10px;"></i>
                    <p>Ch∆∞a c√≥ d·ªØ li·ªáu ch·∫•m c√¥ng</p>
                </div>
            </div>
        </div>
    </div>

    <div class="footer">
        <p>·ª®ng d·ª•ng Ch·∫•m C√¥ng TƒÉng Ca &copy; 2026</p>
        <p><i class="fas fa-database"></i> D·ªØ li·ªáu ƒë∆∞·ª£c l∆∞u tr·ªØ vƒ©nh vi·ªÖn tr√™n thi·∫øt b·ªã</p>
        <p><i class="fas fa-save"></i> T·ª± ƒë·ªông l∆∞u 30 gi√¢y/l·∫ßn + N√∫t l∆∞u th·ªß c√¥ng</p>
    </div>

    <div class="auto-save-indicator" id="autoSaveIndicator">
        <i class="fas fa-sync-alt"></i> <span id="autoSaveStatus">ƒêang l∆∞u...</span>
    </div>

    <div class="data-status" id="dataStatus">
        <i class="fas fa-database"></i> <span id="lastSaveTime">üü¢ ƒê√£ l∆∞u</span>
    </div>

    <!-- Modals -->
    <div class="modal" id="monthCalendarModal">
        <div class="modal-content">
            <h3>
                <i class="fas fa-calendar"></i> üìÖ L·ªãch Th√°ng
                <button class="close-btn" id="closeMonthModal">&times;</button>
            </h3>
            <div class="calendar" id="monthCalendar"></div>
        </div>
    </div>

    <div class="modal" id="dayDetailModal">
        <div class="modal-content">
            <h3>
                <i class="fas fa-calendar-day"></i> üìã Chi Ti·∫øt Ng√†y
                <button class="close-btn" id="closeDayModal">&times;</button>
            </h3>
            <div class="day-detail" id="dayDetailContent"></div>
        </div>
    </div>

    <div class="modal" id="salaryModal">
        <div class="modal-content">
            <h3>
                <i class="fas fa-calculator"></i> üßÆ T√≠nh L∆∞∆°ng TƒÉng Ca
                <button class="close-btn" id="closeSalaryModal">&times;</button>
            </h3>
            
            <div class="salary-input-group">
                <label for="basicSalary"><i class="fas fa-money-bill-wave"></i> L∆∞∆°ng cƒÉn b·∫£n (VNƒê)</label>
                <input type="number" id="basicSalary" class="salary-input" placeholder="Nh·∫≠p l∆∞∆°ng cƒÉn b·∫£n" min="0" step="100000">
            </div>
            
            <div class="salary-input-group">
                <label for="selectedMonth"><i class="fas fa-calendar"></i> Ch·ªçn th√°ng</label>
                <select id="selectedMonth" class="month-select">
                    <option value="">Ch·ªçn th√°ng...</option>
                </select>
            </div>
            
            <button class="btn btn-salary btn-full" id="calculateSalaryBtn">
                <i class="fas fa-calculator"></i> T√≠nh L∆∞∆°ng TƒÉng Ca
            </button>
            
            <div class="salary-result" id="salaryResult" style="display: none;">
                <h4>üí∞ L∆∞∆°ng tƒÉng ca d·ª± ki·∫øn th√°ng n√†y</h4>
                <div class="salary-amount" id="salaryAmount">0 VNƒê</div>
                <div class="salary-details" id="salaryDetails"></div>
            </div>
            
            <div style="margin-top:20px;padding:15px;background-color:rgba(0,122,255,0.1);border-radius:12px;">
                <h4 style="color:var(--primary);margin-bottom:10px;font-size:14px;">
                    <i class="fas fa-info-circle"></i> üìä C√¥ng th·ª©c t√≠nh
                </h4>
                <p style="font-size:13px;color:var(--gray);">
                    üí∞ Ti·ªÅn tƒÉng ca = S·ªë gi·ªù tƒÉng ca √ó (((L∆∞∆°ng cƒÉn b·∫£n √∑ 26) √∑ 8) √ó 2)
                </p>
            </div>
        </div>
    </div>

    <div class="modal" id="confirmDeleteModal">
        <div class="modal-content">
            <h3>
                <i class="fas fa-exclamation-triangle"></i> ‚ö†Ô∏è X√°c nh·∫≠n x√≥a
                <button class="close-btn" id="closeDeleteModal">&times;</button>
            </h3>
            <p id="modalDeleteMessage" style="margin-bottom:20px;">B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a d·ªØ li·ªáu ng√†y n√†y kh√¥ng?</p>
            <div class="modal-buttons">
                <button class="btn btn-secondary" id="cancelDeleteBtn">‚ùå H·ªßy</button>
                <button class="btn btn-danger" id="confirmDeleteBtn">üóëÔ∏è X√≥a</button>
            </div>
        </div>
    </div>

    <div class="notification" id="notification">
        <div id="notificationMessage">‚úÖ Thao t√°c th√†nh c√¥ng!</div>
    </div>

    <script>
        // ============================
        // BI·∫æN TO√ÄN C·ª§C - KH√îNG M·∫§T D·ªÆ LI·ªÜU
        // ============================
        let workStartTime = null;
        let workEndTime = null;
        let isWorking = false;
        let timerInterval = null;
        let autoSaveInterval = null;
        let workData = [];
        let today = new Date();
        let dayOfWeek = today.getDay();
        let isSunday = (dayOfWeek === 0);
        let isWeekday = (dayOfWeek >= 1 && dayOfWeek <= 6);
        let currentMonth = today.getMonth();
        let currentYear = today.getFullYear();
        let selectedDate = null;
        let selectedDayData = null;
        let basicSalary = 0;
        let autoStartTriggered = false;
        let earlyOvertime = 0;
        let lateOvertime = 0;
        let dateToDelete = null;
        let lastSaveTime = null;
        let isSaving = false;

        // ============================
        // KH·ªûI ƒê·ªòNG ·ª®NG D·ª§NG
        // ============================
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Kh·ªüi ƒë·ªông ·ª©ng d·ª•ng Ch·∫•m C√¥ng...');
            initApp();
        });

        function initApp() {
            // 1. T·∫¢I D·ªÆ LI·ªÜU ƒê·∫¶U TI√äN - QUAN TR·ªåNG
            loadWorkData();
            
            // 2. C·∫≠p nh·∫≠t th·ªùi gian
            updateCurrentTime();
            setInterval(updateCurrentTime, 1000);
            
            // 3. C·∫≠p nh·∫≠t UI
            updateDayName();
            initSalaryMonthSelect();
            loadBasicSalary();
            
            // 4. Event listeners
            setupEventListeners();
            
            // 5. Ki·ªÉm tra tr·∫°ng th√°i h√¥m nay
            checkTodayWorkStatus();
            checkAutoStart();
            updateButtonStates();
            
            // 6. B·∫ÆT ƒê·∫¶U AUTO-SAVE 30s
            startAutoSave();
            
            // 7. Hi·ªÉn th·ªã th√¥ng b√°o
            showNotification('‚úÖ ·ª®ng d·ª•ng ƒë√£ s·∫µn s√†ng!', 'info');
            console.log('‚úÖ ·ª®ng d·ª•ng kh·ªüi ƒë·ªông th√†nh c√¥ng. D·ªØ li·ªáu:', workData.length, 'b·∫£n ghi');
        }

        function setupEventListeners() {
            // N√∫t ƒëi·ªÅu khi·ªÉn
            document.getElementById('startWorkBtn').addEventListener('click', startWork);
            document.getElementById('endWorkBtn').addEventListener('click', endWork);
            document.getElementById('saveNowBtn').addEventListener('click', manualSave);
            
            // N√∫t ch·ª©c nƒÉng
            document.getElementById('viewMonthBtn').addEventListener('click', function() { showMonthCalendar(); });
            document.getElementById('salaryBtn').addEventListener('click', function() { showSalaryModal(); });
            
            // Modal buttons
            document.getElementById('closeMonthModal').addEventListener('click', hideMonthModal);
            document.getElementById('closeDayModal').addEventListener('click', hideDayModal);
            document.getElementById('closeSalaryModal').addEventListener('click', hideSalaryModal);
            document.getElementById('closeDeleteModal').addEventListener('click', hideDeleteModal);
            document.getElementById('calculateSalaryBtn').addEventListener('click', calculateSalary);
            document.getElementById('basicSalary').addEventListener('change', saveBasicSalary);
            document.getElementById('cancelDeleteBtn').addEventListener('click', hideDeleteModal);
            document.getElementById('confirmDeleteBtn').addEventListener('click', confirmDeleteDay);
            
            // S·ª± ki·ªán l∆∞u t·ª± ƒë·ªông khi tho√°t
            setupExitSaveHandlers();
        }

        // ============================
        // H·ªÜ TH·ªêNG L∆ØU D·ªÆ LI·ªÜU - KH√îNG M·∫§T
        // ============================
        function setupExitSaveHandlers() {
            // L∆∞u khi m·∫•t focus (chuy·ªÉn tab, app kh√°c)
            window.addEventListener('blur', function() {
                console.log('üì± M·∫•t focus - ƒëang l∆∞u...');
                saveDataToStorage();
            });
            
            // L∆∞u khi page b·ªã ·∫©n (iOS Safari)
            document.addEventListener('visibilitychange', function() {
                if (document.hidden) {
                    console.log('üëÅÔ∏è Page ·∫©n - ƒëang l∆∞u...');
                    saveDataToStorage();
                }
            });
            
            // L∆∞u khi pagehide (iOS)
            window.addEventListener('pagehide', function() {
                console.log('üì¥ Page hide - ƒëang l∆∞u...');
                saveDataToStorage();
            });
            
            // L∆∞u khi unload
            window.addEventListener('unload', function() {
                console.log('üîå Unload - ƒëang l∆∞u...');
                saveDataToStorage();
            });
            
            // L∆∞u tr∆∞·ªõc khi ƒë√≥ng (c√≥ th·ªÉ b·ªã ch·∫∑n tr√™n iOS)
            window.addEventListener('beforeunload', function(e) {
                console.log('‚è∞ Before unload - ƒëang l∆∞u...');
                saveDataToStorage();
            });
        }

        function startAutoSave() {
            console.log('‚è±Ô∏è B·∫Øt ƒë·∫ßu auto-save 30 gi√¢y/l·∫ßn');
            updateDataStatus();
            
            // L∆∞u ngay l·∫ßn ƒë·∫ßu
            saveDataToStorage();
            
            // Auto-save m·ªói 30 gi√¢y
            autoSaveInterval = setInterval(() => {
                if (!isSaving) {
                    console.log('üîÑ Auto-save ƒë·ªãnh k·ª≥...');
                    saveDataToStorage();
                    updateDataStatus();
                    updateAutoSaveIndicator();
                }
            }, 30000); // 30 gi√¢y
        }

        function manualSave() {
            console.log('üíæ Ng∆∞·ªùi d√πng ·∫•n l∆∞u th·ªß c√¥ng');
            const saveBtn = document.getElementById('saveNowBtn');
            
            // Hi·ªáu ·ª©ng n√∫t
            saveBtn.classList.add('saving');
            saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ƒêang l∆∞u...';
            
            // L∆∞u d·ªØ li·ªáu
            const success = saveDataToStorage();
            
            // C·∫≠p nh·∫≠t UI
            setTimeout(() => {
                if (success) {
                    saveBtn.classList.remove('saving');
                    saveBtn.classList.add('saved');
                    saveBtn.innerHTML = '<i class="fas fa-check"></i> ‚úÖ ƒê√£ l∆∞u!';
                    showNotification('üíæ ƒê√£ l∆∞u d·ªØ li·ªáu th√†nh c√¥ng!', 'success');
                    
                    // Reset sau 2 gi√¢y
                    setTimeout(() => {
                        saveBtn.classList.remove('saved');
                        saveBtn.innerHTML = '<i class="fas fa-save"></i> üíæ L∆∞u ngay';
                    }, 2000);
                } else {
                    saveBtn.classList.remove('saving');
                    saveBtn.innerHTML = '<i class="fas fa-exclamation-triangle"></i> ‚ùå L·ªói l∆∞u';
                    showNotification('‚ùå L·ªói khi l∆∞u d·ªØ li·ªáu', 'danger');
                    
                    setTimeout(() => {
                        saveBtn.innerHTML = '<i class="fas fa-save"></i> üíæ L∆∞u ngay';
                    }, 2000);
                }
            }, 500);
        }

        function saveDataToStorage() {
            if (isSaving) return false;
            
            isSaving = true;
            try {
                console.log('üíæ ƒêang l∆∞u d·ªØ li·ªáu v√†o localStorage...');
                
                // 1. L∆∞u workData
                localStorage.setItem('chamcong_work_data', JSON.stringify(workData));
                console.log('‚úÖ ƒê√£ l∆∞u workData:', workData.length, 'b·∫£n ghi');
                
                // 2. L∆∞u tr·∫°ng th√°i l√†m vi·ªác hi·ªán t·∫°i
                if (isWorking && workStartTime) {
                    const currentWorkState = {
                        isWorking: isWorking,
                        workStartTime: workStartTime.getTime(),
                        lastUpdate: Date.now()
                    };
                    localStorage.setItem('chamcong_current_state', JSON.stringify(currentWorkState));
                    console.log('‚úÖ ƒê√£ l∆∞u currentWorkState');
                } else {
                    localStorage.removeItem('chamcong_current_state');
                }
                
                // 3. L∆∞u l∆∞∆°ng cƒÉn b·∫£n
                if (basicSalary > 0) {
                    localStorage.setItem('chamcong_basic_salary', basicSalary.toString());
                    console.log('‚úÖ ƒê√£ l∆∞u basicSalary:', basicSalary);
                }
                
                // 4. C·∫≠p nh·∫≠t th·ªùi gian l∆∞u
                const now = new Date();
                lastSaveTime = now;
                const lastSaveTimeStr = now.toLocaleTimeString('vi-VN', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
                localStorage.setItem('chamcong_last_save', lastSaveTimeStr);
                localStorage.setItem('chamcong_last_save_timestamp', now.getTime().toString());
                console.log('‚úÖ ƒê√£ l∆∞u th·ªùi gian:', lastSaveTimeStr);
                
                // 5. C·∫≠p nh·∫≠t UI
                updateDataStatus();
                
                isSaving = false;
                return true;
                
            } catch (error) {
                console.error('‚ùå L·ªói khi l∆∞u d·ªØ li·ªáu:', error);
                isSaving = false;
                return false;
            }
        }

        function loadWorkData() {
            try {
                console.log('üìÇ ƒêang t·∫£i d·ªØ li·ªáu t·ª´ localStorage...');
                
                // 1. T·∫£i workData
                const savedData = localStorage.getItem('chamcong_work_data');
                if (savedData) {
                    workData = JSON.parse(savedData);
                    console.log('‚úÖ ƒê√£ t·∫£i workData:', workData.length, 'b·∫£n ghi');
                } else {
                    workData = [];
                    console.log('‚ÑπÔ∏è Kh√¥ng c√≥ d·ªØ li·ªáu c≈©, t·∫°o m·ªõi');
                }
                
                // 2. T·∫£i tr·∫°ng th√°i l√†m vi·ªác hi·ªán t·∫°i
                const currentWorkState = localStorage.getItem('chamcong_current_state');
                if (currentWorkState) {
                    const state = JSON.parse(currentWorkState);
                    const lastUpdate = new Date(state.lastUpdate);
                    const now = new Date();
                    const diffMinutes = (now - lastUpdate) / (1000 * 60);
                    
                    // Kh√¥i ph·ª•c n·∫øu ch∆∞a qu√° 60 ph√∫t
                    if (diffMinutes < 60 && state.isWorking) {
                        workStartTime = new Date(state.workStartTime);
                        
                        const todayStr = formatDate(today);
                        const todayRecord = workData.find(record => record.date === todayStr);
                        
                        if (!todayRecord) {
                            const newRecord = {
                                id: Date.now(),
                                date: todayStr,
                                dateISO: formatDateISO(workStartTime),
                                startTime: formatTime(workStartTime),
                                endTime: null,
                                totalHours: '0.00',
                                overtime: '0.00',
                                manualOvertime: '0.00',
                                lunchOvertime: 0,
                                earlyOvertime: 0,
                                lateOvertime: 0,
                                isAutoEnded: false,
                                timestamp: workStartTime.getTime(),
                                isWeekday: isWeekday,
                                isAutoStarted: false
                            };
                            workData.unshift(newRecord);
                            isWorking = true;
                            console.log('‚úÖ ƒê√£ kh√¥i ph·ª•c tr·∫°ng th√°i l√†m vi·ªác t·ª´:', formatTime(workStartTime));
                        }
                    }
                }
                
                // 3. T·∫£i l∆∞∆°ng cƒÉn b·∫£n
                const savedSalary = localStorage.getItem('chamcong_basic_salary');
                if (savedSalary) {
                    basicSalary = parseInt(savedSalary);
                    console.log('‚úÖ ƒê√£ t·∫£i basicSalary:', basicSalary);
                }
                
                // 4. C·∫≠p nh·∫≠t UI
                updateWorkHistory();
                initSalaryMonthSelect();
                updateDataStatus();
                
                console.log('‚úÖ T·∫£i d·ªØ li·ªáu th√†nh c√¥ng');
                
            } catch (error) {
                console.error('‚ùå L·ªói khi t·∫£i d·ªØ li·ªáu:', error);
                workData = [];
                showNotification('‚ùå L·ªói khi t·∫£i d·ªØ li·ªáu c≈©', 'danger');
            }
        }

        function updateDataStatus() {
            try {
                const lastSaveTimeStr = localStorage.getItem('chamcong_last_save') || 'V·ª´a xong';
                document.getElementById('lastSaveTime').textContent = `üíæ ${lastSaveTimeStr}`;
            } catch (e) {
                document.getElementById('lastSaveTime').textContent = '‚ùå L·ªói';
            }
        }

        function updateAutoSaveIndicator() {
            const indicator = document.getElementById('autoSaveIndicator');
            const statusText = document.getElementById('autoSaveStatus');
            
            if (lastSaveTime) {
                const now = new Date();
                const diffSeconds = Math.floor((now - lastSaveTime) / 1000);
                
                if (diffSeconds < 30) {
                    statusText.textContent = `L∆∞u ${diffSeconds}s tr∆∞·ªõc`;
                    indicator.style.backgroundColor = 'rgba(52,199,89,0.1)';
                    indicator.style.color = 'var(--success)';
                } else {
                    statusText.textContent = 'ƒêang ch·ªù l∆∞u...';
                    indicator.style.backgroundColor = 'rgba(255,149,0,0.1)';
                    indicator.style.color = 'var(--warning)';
                }
            }
        }

        // ============================
        // CH·ª®C NƒÇNG CH√çNH
        // ============================
        function updateCurrentTime() {
            const now = new Date();
            today = now;
            dayOfWeek = today.getDay();
            isSunday = (dayOfWeek === 0);
            isWeekday = (dayOfWeek >= 1 && dayOfWeek <= 6);
            
            const dateStr = now.toLocaleDateString('vi-VN', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            const timeStr = now.toLocaleTimeString('vi-VN');
            
            document.getElementById('currentDate').textContent = dateStr;
            document.getElementById('currentTime').textContent = timeStr;
            
            checkAutoStart();
            checkAutoEnd();
        }

        function checkAutoStart() {
            const now = new Date();
            const currentHour = now.getHours();
            const currentMinute = now.getMinutes();
            const currentDay = now.getDay();
            
            const isWeekdayAuto = (currentDay >= 1 && currentDay <= 6);
            
            if (isWeekdayAuto && currentHour >= 7 && currentMinute >= 45 && !autoStartTriggered) {
                if (!isWorking) {
                    autoStartWork();
                }
            }
        }

        function checkAutoEnd() {
            if (isWorking && isWeekday) {
                const now = new Date();
                const currentHour = now.getHours();
                const currentMinute = now.getMinutes();
                
                if (currentHour >= 17 && currentMinute > 0) {
                    autoEndWork();
                }
            }
        }

        function autoStartWork() {
            autoStartTriggered = true;
            
            const startTimeToday = new Date(today);
            startTimeToday.setHours(7, 45, 0, 0);
            
            const todayStr = formatDate(today);
            const todayRecord = workData.find(record => record.date === todayStr);
            
            if (todayRecord) {
                return;
            }
            
            workStartTime = startTimeToday;
            isWorking = true;
            
            document.getElementById('startTime').textContent = '07:45';
            document.getElementById('workStatus').textContent = 'üü¢ ƒêang l√†m vi·ªác (t·ª± ƒë·ªông 7:45)';
            document.getElementById('workStatus').style.color = 'var(--success)';
            
            const startBtn = document.getElementById('startWorkBtn');
            startBtn.classList.add('auto-activated');
            
            const autoStartInfo = document.getElementById('autoStartInfo');
            autoStartInfo.style.display = 'flex';
            
            updateButtonStates();
            startTimer();
            createAutoWorkRecord();
            
            showNotification('ü§ñ T·ª± ƒë·ªông b·∫Øt ƒë·∫ßu l√†m vi·ªác t·ª´ 7:45', 'info');
        }

        function autoEndWork() {
            if (!isWorking) return;
            
            const endTimeToday = new Date(today);
            endTimeToday.setHours(17, 0, 0, 0);
            
            workEndTime = endTimeToday;
            isWorking = false;
            
            stopTimer();
            
            const workDuration = calculateWorkDuration(workStartTime, workEndTime);
            
            let overtime = 0;
            
            if (isWeekday) {
                const standardStartTime = new Date(workStartTime);
                standardStartTime.setHours(7, 45, 0, 0);
                
                if (workStartTime < standardStartTime) {
                    earlyOvertime = calculateWorkDuration(workStartTime, standardStartTime);
                } else {
                    earlyOvertime = 0;
                }
                
                overtime = earlyOvertime;
                
            } else if (isSunday) {
                overtime = workDuration;
            }
            
            document.getElementById('endTime').textContent = '17:00';
            document.getElementById('totalTime').innerHTML = `${workDuration.toFixed(2)}<span class="info-unit">gi·ªù</span>`;
            document.getElementById('overtime').innerHTML = `${overtime.toFixed(2)}<span class="info-unit">gi·ªù</span>`;
            document.getElementById('workStatus').textContent = 'üü° ƒê√£ k·∫øt th√∫c l√†m vi·ªác (t·ª± ƒë·ªông 17:00)';
            document.getElementById('workStatus').style.color = 'var(--warning)';
            
            updateButtonStates();
            saveWorkData(workStartTime, workEndTime, workDuration, overtime, true);
            updateWorkHistory();
            updateExpectedSalary();
            
            showNotification(`‚è∞ T·ª± ƒë·ªông tan ca 17:00. TƒÉng ca: ${overtime.toFixed(2)} gi·ªù`, 'info');
        }

        function startWork() {
            if (isWorking) {
                showNotification('‚ö†Ô∏è B·∫°n ƒë√£ b·∫Øt ƒë·∫ßu l√†m vi·ªác tr∆∞·ªõc ƒë√≥!', 'warning');
                return;
            }
            
            workStartTime = new Date();
            isWorking = true;
            
            document.getElementById('startTime').textContent = formatTime(workStartTime);
            document.getElementById('workStatus').textContent = 'üü¢ ƒêang l√†m vi·ªác';
            document.getElementById('workStatus').style.color = 'var(--success)';
            
            const autoStartInfo = document.getElementById('autoStartInfo');
            autoStartInfo.style.display = 'none';
            
            const startBtn = document.getElementById('startWorkBtn');
            startBtn.classList.remove('auto-activated');
            
            updateButtonStates();
            startTimer();
            
            const todayStr = formatDate(today);
            const autoRecordIndex = workData.findIndex(record => record.date === todayStr && record.isAutoStarted);
            if (autoRecordIndex >= 0) {
                workData.splice(autoRecordIndex, 1);
            }
            
            showNotification('üöÄ ƒê√£ b·∫Øt ƒë·∫ßu l√†m vi·ªác', 'success');
        }

        function endWork() {
            if (!isWorking) {
                showNotification('‚ö†Ô∏è B·∫°n ch∆∞a b·∫Øt ƒë·∫ßu l√†m vi·ªác!', 'warning');
                return;
            }
            
            workEndTime = new Date();
            isWorking = false;
            
            stopTimer();
            
            const workDuration = calculateWorkDuration(workStartTime, workEndTime);
            let overtime = 0;
            
            if (isWeekday) {
                const standardStartTime = new Date(workStartTime);
                standardStartTime.setHours(7, 45, 0, 0);
                
                if (workStartTime < standardStartTime) {
                    earlyOvertime = calculateWorkDuration(workStartTime, standardStartTime);
                } else {
                    earlyOvertime = 0;
                }
                
                const standardEndTime = new Date(workStartTime);
                standardEndTime.setHours(17, 0, 0, 0);
                
                if (workEndTime > standardEndTime) {
                    lateOvertime = calculateWorkDuration(standardEndTime, workEndTime);
                } else {
                    lateOvertime = 0;
                }
                
                overtime = earlyOvertime + lateOvertime;
                
            } else if (isSunday) {
                overtime = workDuration;
            }
            
            document.getElementById('endTime').textContent = formatTime(workEndTime);
            document.getElementById('totalTime').innerHTML = `${workDuration.toFixed(2)}<span class="info-unit">gi·ªù</span>`;
            document.getElementById('overtime').innerHTML = `${overtime.toFixed(2)}<span class="info-unit">gi·ªù</span>`;
            document.getElementById('workStatus').textContent = 'üü° ƒê√£ k·∫øt th√∫c l√†m vi·ªác';
            document.getElementById('workStatus').style.color = 'var(--warning)';
            
            updateButtonStates();
            saveWorkData(workStartTime, workEndTime, workDuration, overtime, false);
            updateWorkHistory();
            updateExpectedSalary();
            
            showNotification(`üèÅ ƒê√£ tan ca. TƒÉng ca: ${overtime.toFixed(2)} gi·ªù`, 'success');
        }

        // ============================
        // C√ÅC H√ÄM H·ªñ TR·ª¢
        // ============================
        function updateWorkHistory() {
            const historyContainer = document.getElementById('workHistory');
            
            if (workData.length === 0) {
                historyContainer.innerHTML = `
                    <div style="text-align: center; padding: 30px; color: var(--gray);">
                        <i class="fas fa-history" style="font-size: 40px; margin-bottom: 10px;"></i>
                        <p>Ch∆∞a c√≥ d·ªØ li·ªáu ch·∫•m c√¥ng</p>
                        <p style="font-size: 12px; margin-top: 10px; color: var(--gray);">B·∫Øt ƒë·∫ßu ch·∫•m c√¥ng ƒë·ªÉ xem l·ªãch s·ª≠</p>
                    </div>
                `;
                return;
            }
            
            let historyHTML = '';
            
            workData.forEach(record => {
                const isTodayRecord = record.date === formatDate(today);
                const todayClass = isTodayRecord ? 'style="color: var(--primary); font-weight: 700;"' : '';
                const totalOvertime = parseFloat(record.overtime);
                const lunchOvertime = record.lunchOvertime || 0;
                const autoStarted = record.isAutoStarted || false;
                const isAutoEnded = record.isAutoEnded || false;
                const isSundayRecord = !record.isWeekday;
                
                const dayIcon = isSundayRecord ? 'üéØ' : 'üìÖ';
                const autoStartIcon = autoStarted ? 'ü§ñ' : '';
                const autoEndIcon = isAutoEnded ? '‚è∞' : '';
                const lunchIcon = lunchOvertime > 0 ? 'üç¥' : '';
                
                historyHTML += `
                    <div class="history-item">
                        <div>
                            <div class="history-date" ${todayClass}>
                                ${dayIcon} ${record.date} ${isSundayRecord ? '(CN)' : '(T2-T7)'} 
                                ${autoStartIcon} ${autoEndIcon}
                            </div>
                            <div class="history-time">${record.startTime} - ${record.endTime || '--:--'}</div>
                        </div>
                        <div class="history-overtime">
                            ${record.endTime ? `üí∞ +${totalOvertime.toFixed(2)} gi·ªù` : 'üü¢ ƒêang l√†m'} 
                            ${lunchIcon}
                        </div>
                    </div>
                `;
            });
            
            historyContainer.innerHTML = historyHTML;
        }

        // ============================
        // C√ÅC H√ÄM FORMAT
        // ============================
        function calculateWorkDuration(startTime, endTime) {
            const diffMs = endTime - startTime;
            const diffMinutes = diffMs / (1000 * 60);
            const diffHours = diffMinutes / 60;
            return diffHours;
        }

        function formatTime(date) {
            return date.toLocaleTimeString('vi-VN', { hour: '2-digit', minute: '2-digit' });
        }

        function formatDate(date) {
            return date.toLocaleDateString('vi-VN');
        }

        function formatDateISO(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            const messageElement = document.getElementById('notificationMessage');
            
            let bgColor = 'var(--primary)';
            if (type === 'success') bgColor = 'var(--success)';
            if (type === 'warning') bgColor = 'var(--warning)';
            if (type === 'danger') bgColor = 'var(--danger)';
            
            notification.style.backgroundColor = bgColor;
            notification.className = 'notification';
            notification.classList.add(type);
            messageElement.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // ============================
        // H√ÄM C√íN L·∫†I (gi·ªØ nguy√™n)
        // ============================
        function updateDayName() {
            const dayNames = ['Ch·ªß nh·∫≠t', 'Th·ª© hai', 'Th·ª© ba', 'Th·ª© t∆∞', 'Th·ª© nƒÉm', 'Th·ª© s√°u', 'Th·ª© b·∫£y'];
            const dayName = dayNames[dayOfWeek];
            
            document.getElementById('dayName').textContent = dayName;
            
            const dayIndicator = document.getElementById('dayIndicator');
            if (isSunday) {
                dayIndicator.classList.add('sunday');
            } else {
                dayIndicator.classList.remove('sunday');
            }
        }

        function checkTodayWorkStatus() {
            const todayStr = formatDate(today);
            const todayRecord = workData.find(record => record.date === todayStr);
            
            if (todayRecord) {
                workStartTime = parseTimeString(todayRecord.startTime, today);
                workEndTime = todayRecord.endTime ? parseTimeString(todayRecord.endTime, today) : null;
                isWorking = !todayRecord.endTime;
                earlyOvertime = todayRecord.earlyOvertime || 0;
                lateOvertime = todayRecord.lateOvertime || 0;
                
                if (todayRecord.isAutoStarted) {
                    autoStartTriggered = true;
                    const startBtn = document.getElementById('startWorkBtn');
                    startBtn.classList.add('auto-activated');
                    
                    const autoStartInfo = document.getElementById('autoStartInfo');
                    autoStartInfo.style.display = 'flex';
                }
                
                document.getElementById('startTime').textContent = formatTime(workStartTime);
                
                if (workEndTime) {
                    document.getElementById('endTime').textContent = formatTime(workEndTime);
                    document.getElementById('workStatus').textContent = todayRecord.isAutoEnded ? 
                        'üü° ƒê√£ k·∫øt th√∫c l√†m vi·ªác (t·ª± ƒë·ªông 17:00)' : 'üü° ƒê√£ k·∫øt th√∫c l√†m vi·ªác';
                    document.getElementById('workStatus').style.color = 'var(--warning)';
                    
                    const totalHours = parseFloat(todayRecord.totalHours);
                    const overtime = parseFloat(todayRecord.overtime);
                    
                    document.getElementById('totalTime').innerHTML = `${totalHours.toFixed(2)}<span class="info-unit">gi·ªù</span>`;
                    document.getElementById('overtime').innerHTML = `${overtime.toFixed(2)}<span class="info-unit">gi·ªù</span>`;
                    
                    updateExpectedSalary();
                } else {
                    document.getElementById('endTime').textContent = '--:--';
                    document.getElementById('workStatus').textContent = 'üü¢ ƒêang l√†m vi·ªác';
                    document.getElementById('workStatus').style.color = 'var(--success)';
                    startTimer();
                }
            }
            
            updateButtonStates();
        }

        // C√°c h√†m kh√°c (createAutoWorkRecord, updateButtonStates, startTimer, stopTimer, saveWorkData, 
        // loadBasicSalary, saveBasicSalary, updateExpectedSalary, initSalaryMonthSelect, showSalaryModal,
        // showMonthCalendar, hideMonthModal, hideDayModal, hideSalaryModal, hideDeleteModal, renderCalendar,
        // showDayDetail, showDeleteConfirmation, confirmDeleteDay, updateDayTime, createNewDayRecord,
        // calculateSalary, formatCurrency) v·∫´n gi·ªØ nguy√™n nh∆∞ code tr∆∞·ªõc

        // Do gi·ªõi h·∫°n ƒë·ªô d√†i, c√°c h√†m n√†y v·∫´n gi·ªØ nguy√™n logic c≈©
        // Ch·ªâ c·∫ßn sao ch√©p t·ª´ code tr∆∞·ªõc v√†o ƒë√¢y

    </script>
</body>
</html>
